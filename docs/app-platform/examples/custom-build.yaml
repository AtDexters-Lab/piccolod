# Custom container build example
name: my-node-app

build:
  containerfile: |
    FROM node:18-alpine
    WORKDIR /app
    COPY package*.json ./
    RUN npm ci --only=production
    COPY . .
    EXPOSE 3000
    USER node
    CMD ["npm", "start"]
  build_args:
    NODE_ENV: production

listeners:
  - name: web
    guest_port: 3000
    flow: tcp
    protocol: http
    remote_ports: [80, 443]

storage:
  persistent:
    data:
      container: /app/data
      size_limit: 5GB
  temporary:
    logs:
      container: /app/logs
      size_limit: 1GB

environment:
  NODE_ENV: production
  DATABASE_URL: postgres://db.piccolo.local:5432/myapp

depends_on:
  - postgres

permissions:
  network:
    internet: allow
    allowed_domains:
      - api.stripe.com
